{% load l10n %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Оплата успішна - PASUE Club</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
        }
        .success-container {
            background: white;
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
        }
        .success-icon {
            font-size: 4rem;
            color: #4CAF50;
            margin-bottom: 1rem;
        }
        .success-title {
            color: #333;
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        .success-text {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
        }
        .order-details {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1.5rem 0;
            text-align: left;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        .detail-row:last-child {
            border-bottom: none;
        }
        .back-button {
            background: #667eea;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background 0.3s;
        }
        .back-button:hover {
            background: #5a6fd8;
        }
    </style>
    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '2342533109544263');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=2342533109544263&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
</head>
<body>
    <div class="success-container">
        <div class="success-icon">✅</div>
        <h1 class="success-title">Оплата успішна!</h1>
        <p class="success-text">
            Дякуємо за покупку квитка на Grand Opening Party від PASUE Club!<br>
            Лист з підтвердженням надіслано на вашу електронну пошту.
        </p>

        {% if order %}
        <div class="order-details">
            <div class="detail-row">
                <strong>Email:</strong>
                <span>{{ order.email }}</span>
            </div>
            <div class="detail-row">
                <strong>Телефон:</strong>
                <span>{{ order.phone }}</span>
            </div>
            <div class="detail-row">
                <strong>Номер замовлення:</strong>
                <span>{{ order.wayforpay_order_reference }}</span>
            </div>
            <div class="detail-row">
                <strong>Сума:</strong>
                <span>{{ order.amount }} UAH</span>
            </div>
        </div>
        {% endif %}

        <a href="{% url 'opening' %}" class="back-button">Повернутися на головну</a>
    </div>
    <!-- Meta Pixel: Purchase Event -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        if (typeof fbq === 'function') {
          const amount = {{ order.amount|unlocalize|floatformat:2 }};
          const currency = 'UAH'.trim(); // очищує від пробілів
          const contentName = '{{ order.event_name|escapejs }}'.trim();

          fbq('track', 'Purchase', {
            value: amount,
            currency: currency,
            content_name: contentName
          });

          console.log('✅ Meta Pixel: Purchase event sent', { amount, currency, contentName });
        } else {
          console.warn('⚠️ Meta Pixel not loaded');
        }
      });
    </script>

</body>
</html>