{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>PASUE Club - Grand Opening Party</title>
    <meta
      name="description"
      content="Перша подія від PASUE Club - закрите жіноче комʼюніті. Приєднуйся до Grand Opening Party!"
    />
    <link rel="stylesheet" href="{% static 'css/mobile.css' %}" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=New+Rocker&display=swap" rel="stylesheet">
</head>
<body>
    <header class="site-header">
      <div class="container header-container">
        <div class="menu-container"> <!-- доданий контейнер -->
          <button class="menu-button" aria-label="Open menu">
            <img src="{% static 'images/logo_burger_mob.png' %}" alt="Menu Icon">
          </button>
          <div class="menu-overlay"></div>
          <div class="dropdown-menu" id="dropdown-menu">
              <!-- Логотип зверху -->
{#              <a href="#hero" class="menu-logo">#}
{#                  <img src="{% static 'images/main_logo_v2_mob.png' %}" alt="PASUE Club Logo">#}
{#              </a>#}
                <!-- Пункти меню -->
              <a href="#about" class="menu-item">Про PASUE Club</a>
              <a href="#highlights" class="menu-item">Про івент Grand Opening Party</a>
              <a href="#ticket" class="menu-item">Особлива гостя вечора</a>
              <a href="#ticket" class="menu-item">Купити квиток</a>
              <div class="social_links">
                <a href="https://instagram.com/pasueclub" class="social_link" target="_blank" aria-label="Instagram">
                  <img src="{% static 'images/instagram.png' %}" alt="Instagram" />
                </a>
                <a href="https://t.me/pasueclub" class="social_link" target="_blank" aria-label="Telegram">
                  <img src="{% static 'images/telegram.png' %}" alt="Telegram" />
                </a>
                <a href="mailto:info@pasueclub.com" class="social_link" aria-label="Email">
                  <img src="{% static 'images/email.png' %}" alt="Email" />
                </a>
              </div>
          </div>
        </div>
        <a href="#hero" class="logo">
          <img src="{% static 'images/main_logo_mob.png' %}" alt="PASUE Club Logo">
        </a>
      </div>
    </header>
    <section id="hero" class="hero-section">
      <div class="container hero-container">
        <div class="hero-text">
          <h1 class="hero-title">
            <span class="title-grand">Grand</span>
            <span class="title-main">Opening Party</span>
          </h1>
          <p class="hero-subtitle">Перша подія від PASUE Club -<br>це більше, ніж вечірка</p>
          <p class="hero-subtitle">Це святкування відкриття<br>нового жіночого комʼюніті</p>
        </div>
        <img class="hero-image" src="{% static 'images/logo_rabbit_mob.png' %}" alt="A rabbit in a red jacket reading a scroll">

        <div class="hero-cta-wrapper">
          <a href="#ticket" class="cta-button">
            <img src="{% static 'images/key-1-mob.png' %}" alt="Key Icon" width="41" height="39">
            <span>Стати учасницею події</span>
          </a>
          <p class="cta-subtext">Це твій вхід в унікальний простір, який створений спеціально для тебе</p>
        </div>

        <div class="ps-note">
          <img class="ps-image" src="{% static 'images/letter_mob.png' %}" alt="Envelope with a wax seal">
          <p class="ps-text">P.S. Ти знайшла місце натхнення, де будеш почутою, побаченою, важливою і потрібною</p>
        </div>
      </div>
    </section>
    <section id="about" class="about-section">
      <div class="container">
        <div class="about-title-wrapper">
          <h2 class="about-title">Що таке</h2>
          <img src="{% static 'images/main_logo_v2_mob.png' %}" alt="PASUE Club" class="about-title-logo">
        </div>
        <div class="features-list">
          <div class="feature-item">
            <!--merged image-->
            <div class="feature-image-wrapper">
              <img src="{% static 'images/heart_mob.png' %}" alt="Decorative shield" class="feature-bg-img">
              <img src="{% static 'images/black_ellipse_mob.png' %}" alt="" class="feature-icon-svg">
            </div>
            <div class="feature-text">
              <h3>Закрите комʼюніті</h3>
              <p>Тут ти знайдеш підтримку, сестринство та безпечний простір без порівнянь, конкуренції чи осуду</p>
            </div>
          </div>
          <div class="feature-item">
            <!--merged image-->
            <div class="feature-image-wrapper">
              <img src="{% static 'images/castle_mob.png' %}" alt="Pink castle" class="feature-bg-img">
              <img src="{% static 'images/black_ellipse_mob.png' %}" alt="" class="feature-icon-svg">
            </div>
            <div class="feature-text">
              <h3>PASUE City онлайн</h3>
              <p>Віртуальне місто у Telegram - це територія спілкування, щоденних ритуалів та інсайтів від експертів</p>
            </div>
          </div>
          <div class="feature-item">
            <!--merged image-->
            <div class="feature-image-wrapper">
              <img src="{% static 'images/mask_mob.png' %}" alt="Venetian mask" class="feature-bg-img">
              <img src="{% static 'images/black_ellipse_mob.png' %}" alt="" class="feature-icon-svg">
            </div>
            <div class="feature-text">
              <h3>Події з атмосферою</h3>
              <p>Камерні вечори, ретрити і тематичні зустрічі, де ти зможеш відпочити та перезавантажитись</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="highlights" class="highlights-section">
      <div class="container highlights-container">
        <h2 class="section-title">Event Highlights</h2>
        <img class="highlights-bg-img" src="{% static 'images/lamp_mob.png' %}" alt="Chandelier">
        <p class="highlights-subtitle">Що на тебе чекає:</p>
        <ul class="highlights-list">
          <li class="highlight-item">
            <img src="{% static 'images/logo_butterfly.png' %}" alt="Bow icon">
            <p><strong>Жива розмова без фільтрів:</strong><br>спікерка, яку знають і люблять за чесність, глибину та тонкий гумор</p>
          </li>
          <li class="highlight-item">
            <img src="{% static 'images/logo_butterfly.png' %}" alt="Bow icon">
            <p><strong>Моменти, які хочеться зупинити:</strong><br>фотозона, легка музика, частування, живе спілкування та щирі емоції</p>
          </li>
          <li class="highlight-item">
            <img src="{% static 'images/logo_butterfly.png' %}" alt="Bow icon">
            <p><strong>Турбота у деталях:</strong><br>ексклюзивні подарунки для кожної, створені з думкою про твій настрій</p>
          </li>
          <li class="highlight-item">
            <img src="{% static 'images/logo_butterfly.png' %}" alt="Bow icon">
            <p><strong>Візуальна терапія:</strong><br>атмосфера PASUE Club продумана до дрібниць, щоб ти відчула задоволення</p>
          </li>
        </ul>

        <p class="highlights-summary">
          <strong>І головне — перше знайомство з комʼюніті PASUE</strong><br>Ти зможеш приєднатися до простору, де можна бути собою, відчувати, творити й надихатися
        </p>

        <a href="#ticket" class="cta-button">
          <img src="{% static 'images/key-2-mob.png' %}" alt="Key Icon" width="41" height="39">
          <span>Приєднатися до вечора</span>
        </a>
      </div>
    </section>
    <section id="ticket" class="ticket-section">
      <div class="container">
        <div class="guest-intro">
          <img src="{% static 'images/special_guest_mob.png' %}" alt="Special Guest decorative text">
          <p>Спікерка вечора:</p>
        </div>

        <!--merged image-->
        <div class="guest-image-wrapper">
          <img class="guest-img-bg" src="{% static 'images/ellipse_guest_mob.png' %}" alt="">
          <img class="guest-img-main" src="{% static 'images/special_guest_logo_mob.png' %}" alt="Silhouette of the special guest">
          <img class="guest-img-mirror" src="{% static 'images/mirror_mob.png' %}" alt="Golden mirror">
        </div>

        <div class="ticket-form-container">
          <h2 class="ticket-title">Get your ticket</h2>
          <p class="ticket-subtitle">Заповни форму і отримай свій квиток</p>

          <div class="ticket-form-wrapper">
              <img src="{% static 'images/ticket_mob.png' %}" alt="Ticket background" class="ticket-form-wrapper">
            <form class="ticket-form">
              {% csrf_token %}
              <div class="form-group">
                <label for="email">E-mail:</label>
                <input type="email"
                       id="email"
                       name="email"
                       required
                       placeholder="user@example.com"
                       autocomplete="email">
                <div class="error-message" id="email-error" style="display: none;"></div>
              </div>
              <div class="form-group">
                <label for="phone">Номер телефону:</label>
                <input type="tel"
                       id="phone"
                       name="phone"
                       required
                       placeholder="+38(xxx)xxx-xx-xx"
                       autocomplete="tel">
                <div class="error-message" id="phone-error" style="display: none;"></div>
              </div>
              <div class="form-footer">
                <span class="price-label">1789</span>
                <span class="price-label-2">UAH</span>
                <button type="submit" class="submit-button">Отримати</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>
    <footer id="footer" class="site-footer">
      <div class="container footer-container">
        <div class="social-links">
          <a href="#" aria-label="Instagram"><img src="{% static 'images/instagram-icon.png' %}" alt="Instagram"></a>
          <a href="#" aria-label="Telegram"><img src="{% static 'images/telegram-icon.png' %}" alt="Telegram"></a>
          <a href="#" aria-label="Email"><img src="{% static 'images/email-icon.png' %}" alt="Email"></a>
        </div>
        <nav class="footer-nav">
          <a href="#" data-popup="terms">Правила та умови</a>
          <a href="#" data-popup="refund">Політика повернення коштів</a>
        </nav>
        <div class="popup" id="popup-terms">
          <div class="popup-content mobile">
            <h2>Правила та умови</h2>

            <p><b>Опис послуги:</b></p>
              <ul>Цей сайт є офіційною онлайн-<br>платформою PASUE Club, де Ви можете<br> придбати квитки на заходи клубу.</ul>

            <p><b>Умови замовлення:</b></p>
              <li>Покупець зобов'язується надати<br> достовірну контактну інформацію.</li>
              <li>Замовлення вважається дійсним<br> лише після підтвердження успішної<br> оплати на email покупця.</li>

            <p><b>Оплата:</b><br></p>
              <li>Оплата здійснюється онлайн за<br> допомогою платіжної системи<br> WayForPay.</li>
              <li>Валюта платежу — гривня (UAH).</li>

            <p><b>Доставка:</b><br></p>
              <li>Електронні квитки надсилаються<br> на email одразу після підтвердження<br> оплати.</li>

            <span class="popup-close">✕</span>
          </div>
        </div>

        <!-- ПОПАП: Політика повернення коштів -->
        <div class="popup" id="popup-refund">
          <div class="popup-content mobile">
            <h2>Політика повернення коштів</h2>
            <ol>
              <li>Повернення коштів за електронні<br> квитки на події не передбачене,<br> окрім випадків скасування заходу з<br> ініціативи організатора.</li>
              <li>Якщо подія перенесена, квиток<br> залишається дійсним. У разі<br> неможливості відвідування —<br> прохання повідомити на email.</li>
              <li>Замовлення можна скасувати до<br> моменту оплати.</li>
            </ol>
            <span class="popup-close">✕</span>
          </div>
        </div>

        <p class="copyright">Всі права захищені</p>
      </div>
    </footer>
    <script>
        function checkScreenSize() {
          if (window.innerWidth > 768) {
            if (window.location.pathname.includes("/mobile/")) {
              window.location.href = "{% url 'index' %}";
            }
          }
        }
        checkScreenSize();
        window.addEventListener("resize", checkScreenSize);
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
          const menuButton = document.querySelector('.menu-button');
          const dropdownMenu = document.querySelector('.dropdown-menu');
          const overlay = document.querySelector('.menu-overlay');

          if (!menuButton || !dropdownMenu || !overlay) return;

          function openMenu() {
            dropdownMenu.classList.add('open');
            overlay.classList.add('active');
            menuButton.setAttribute('aria-expanded', 'true');
          }

          function closeMenu() {
            dropdownMenu.classList.remove('open');
            overlay.classList.remove('active');
            menuButton.setAttribute('aria-expanded', 'false');
          }

          menuButton.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdownMenu.classList.contains('open') ? closeMenu() : openMenu();
          });

          overlay.addEventListener('click', closeMenu);

          dropdownMenu.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', closeMenu);
          });
        });
    </script>
    <script>
        document.querySelectorAll('[data-popup]').forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            let popupId = "popup-" + this.dataset.popup;
            document.getElementById(popupId).style.display = "flex";
          });
        });

        document.querySelectorAll('.popup-close').forEach(btn => {
          btn.addEventListener('click', function() {
            this.closest('.popup').style.display = "none";
          });
        });

        window.addEventListener('click', function(e) {
          if (e.target.classList.contains('popup')) {
            e.target.style.display = "none";
          }
        });
    </script>
{#    форма реєстрації#}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('.ticket-form');
        const emailInput = document.getElementById('email');
        const phoneInput = document.getElementById('phone');

        // Форматування номера телефону під час введення
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');

            // Якщо поле стерли — залишаємо порожнім
            if (value === "") {
                e.target.value = "";
                return;
            }

            // Якщо користувач починає вводити не з 38 — підставимо +38
            if (!value.startsWith("38")) {
                value = "38" + value;
            }

            value = "+" + value;

            // Форматування: +38(0XX)XXX-XX-XX
            if (value.length >= 4) {
                value = value.replace(/(\+38)(\d{3})/, '$1($2)');
            }
            if (value.length >= 9) {
                value = value.replace(/(\+38\(\d{3}\))(\d{3})/, '$1$2-');
            }
            if (value.length >= 13) {
                value = value.replace(/(\+38\(\d{3}\)\d{3}-)(\d{2})/, '$1$2-');
            }

            e.target.value = value.substring(0, 17);
        });

        // Додаємо підтримку видалення
        phoneInput.addEventListener('keydown', function(e) {
            if (e.key === 'Backspace' || e.key === 'Delete') {
                let pos = this.selectionStart;
                let val = this.value;

                // Якщо перед курсором спецсимвол – видаляємо його теж
                if (pos > 0 && /[\-\(\)\s]/.test(val[pos-1])) {
                    e.preventDefault();
                    this.value = val.slice(0, pos-1) + val.slice(pos);
                    this.setSelectionRange(pos-1, pos-1);
                }

                // Якщо залишився тільки +38 і далі видаляють — очищаємо поле
                if (this.value === "+38") {
                    e.preventDefault();
                    this.value = "";
                }
            }
        });

        // Обробка відправки форми
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = new FormData();
            formData.append('email', emailInput.value);
            formData.append('phone', phoneInput.value);
            formData.append('csrfmiddlewaretoken', getCookie('csrftoken'));

            // Показуємо індикатор завантаження
            const submitBtn = form.querySelector('.submit-button');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Обробка...';
            submitBtn.disabled = true;

            fetch('/submit-ticket/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    redirectToWayForPay(data.wayforpay_params);
                } else {
                    showValidationErrors(data.errors);
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Виникла помилка. Спробуйте ще раз.');
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            });
        });
    });

    // Допоміжні функції
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function showValidationErrors(errors) {
        document.querySelectorAll('.error-message').forEach(el => el.remove());

        Object.keys(errors).forEach(field => {
            const input = document.getElementById(field);
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.style.color = 'red';
            errorDiv.style.fontSize = '12px';
            errorDiv.style.marginTop = '5px';
            errorDiv.textContent = errors[field][0];

            input.parentNode.appendChild(errorDiv);
            input.style.borderColor = 'red';
        });
    }

    function redirectToWayForPay(params) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = 'https://secure.wayforpay.com/pay';

        Object.keys(params).forEach(key => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = Array.isArray(params[key]) ? params[key][0] : params[key];
            form.appendChild(input);
        });

        document.body.appendChild(form);
        form.submit();
    }
    </script>
</body>
</html>